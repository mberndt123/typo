/**
 * File has been automatically generated by `typo`.
 *
 * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.
 */
package anorm.adventureworks

import java.sql.Connection
import resource.managed

object ExecuteReturningSyntax {
  /* add executeReturning to anorm. it needs to be inside the package, because everything is hidden */
  implicit class Ops(batchSql: anorm.BatchSql) {
    def executeReturning[T](parser: anorm.ResultSetParser[T])(implicit c: Connection): T =
      managed(batchSql.getFilledStatement(c, getGeneratedKeys = true))(using anorm.StatementResource, anorm.statementClassTag).acquireAndGet { ps =>
        ps.executeBatch()
        anorm.Sql
          .asTry(
            parser,
            managed(ps.getGeneratedKeys)(using anorm.ResultSetResource, anorm.resultSetClassTag),
            onFirstRow = false,
            anorm.ColumnAliaser.empty
          )
          .get
      }
  }
}
