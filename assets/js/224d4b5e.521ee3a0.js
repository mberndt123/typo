"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[6479],{6745:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var t=s(4848),o=s(8453);const i={title:"Generated code for relations"},r=void 0,a={id:"what-is/relations",title:"Generated code for relations",description:"Typo takes the chore out of writing repository code to access your PostgreSQL database relations by automatically",source:"@site/docs/what-is/relations.md",sourceDirName:"what-is",slug:"/what-is/relations",permalink:"/typo/docs/what-is/relations",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Generated code for relations"},sidebar:"tutorialSidebar",previous:{title:"SQL is king!",permalink:"/typo/docs/what-is/sql-is-king"},next:{title:"SQL DSL",permalink:"/typo/docs/what-is/dsl"}},d={},l=[{value:"Tables",id:"tables",level:2},{value:"Primary Key Types",id:"primary-key-types",level:3},{value:"Row Class",id:"row-class",level:3},{value:"Repository interface",id:"repository-interface",level:3},{value:"Simplified Insertion",id:"simplified-insertion",level:3},{value:"Readonly repositories",id:"readonly-repositories",level:3},{value:"Views",id:"views",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Typo takes the chore out of writing repository code to access your PostgreSQL database relations by automatically\ngenerating it for you. Whether you're dealing with tables or views, Typo's generated code simplifies database\ninteraction, saving you time and effort."}),"\n",(0,t.jsx)(n.p,{children:"It incorporates crucial database information such as strongly typed primary key types, comments, check constraints, and foreign keys.\nThis not only simplifies your code but also empowers developers with a deep understanding of the database structure."}),"\n",(0,t.jsx)(n.p,{children:"With Typo, you can spend more time focusing on your application logic and less time on repetitive database access code, all while\nhaving the tools to perform CRUD operations efficiently."}),"\n",(0,t.jsx)(n.h2,{id:"tables",children:"Tables"}),"\n",(0,t.jsx)(n.p,{children:"For tables, Typo generates comprehensive repository code. Take for instance this table:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"create table address\n(\n    addressid       serial\n        constraint \"PK_Address_AddressID\" primary key,\n    addressline1    varchar(60)                          not null,\n    addressline2    varchar(60),\n    city            varchar(30)                          not null,\n    stateprovinceid integer                              not null\n        constraint \"FK_Address_StateProvince_StateProvinceID\" references stateprovince,\n    postalcode      varchar(15)                          not null,\n    spatiallocation bytea,\n    rowguid         uuid      default uuid_generate_v1() not null,\n    modifieddate    timestamp default now()              not null\n);\n\ncomment on table address is 'Street address information for customers, employees, and vendors.';\ncomment on column address.addressid is 'Primary key for Address records.';\ncomment on column address.addressline1 is 'First street address line.';\ncomment on column address.addressline2 is 'Second street address line.';\ncomment on column address.city is 'Name of the city.';\ncomment on column address.stateprovinceid is 'Unique identification number for the state or province. Foreign key to StateProvince table.';\ncomment on column address.postalcode is 'Postal code for the street address.';\ncomment on column address.spatiallocation is 'Latitude and longitude of this address.';\n"})}),"\n",(0,t.jsx)(n.h3,{id:"primary-key-types",children:"Primary Key Types"}),"\n",(0,t.jsxs)(n.p,{children:["Typo generates strongly typed ",(0,t.jsx)(n.a,{href:"/typo/docs/type-safety/id-types",children:"primary key types"}),", ensuring correct usage and enforcement of data integrity.\nYou also get types for composite primary keys."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:"/** Type for the primary key of table `person.address` */\ncase class AddressId(value: Int) extends AnyVal\nobject AddressId {\n  // ...instances\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"row-class",children:"Row Class"}),"\n",(0,t.jsxs)(n.p,{children:["You'll receive a meticulously crafted row case class that precisely mirrors your table structure.\nThe field names are beautified (see ",(0,t.jsx)(n.a,{href:"/typo/docs/customization/customize-naming",children:"Customize naming"})," for how to tweak naming),\nand the corresponding types are correct."]}),"\n",(0,t.jsx)(n.p,{children:"Relevant column comments, check constraints and foreign keys are clearly marked,\nmaking it easy to understand the purpose of every column."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:"import adventureworks.customtypes.*\nimport adventureworks.person.address.AddressId\nimport adventureworks.person.stateprovince.StateprovinceId\nimport java.util.UUID\n\n/** Table: person.address\n    Street address information for customers, employees, and vendors.\n    Primary key: addressid */\ncase class AddressRow(\n  /** Primary key for Address records.\n      Default: nextval('person.address_addressid_seq'::regclass) */\n  addressid: AddressId,\n  /** First street address line. */\n  addressline1: /* max 60 chars */ String,\n  /** Second street address line. */\n  addressline2: Option[/* max 60 chars */ String],\n  /** Name of the city. */\n  city: /* max 30 chars */ String,\n  /** Unique identification number for the state or province. Foreign key to StateProvince table.\n      Points to [[stateprovince.StateprovinceRow.stateprovinceid]] */\n  stateprovinceid: StateprovinceId,\n  /** Postal code for the street address. */\n  postalcode: /* max 15 chars */ String,\n  /** Latitude and longitude of this address. */\n  spatiallocation: Option[TypoBytea],\n  /** Default: uuid_generate_v1() */\n  rowguid: TypoUUID,\n  /** Default: now() */\n  modifieddate: TypoLocalDateTime\n)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"repository-interface",children:"Repository interface"}),"\n",(0,t.jsx)(n.p,{children:"Typo generates a repository interface tailored to your table, providing methods efficient CRUD (Create, Read, Update,\nDelete) operations at your fingertips."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:"import adventureworks.person.address.{AddressFields, AddressRow}\nimport java.sql.Connection\nimport typo.dsl.{DeleteBuilder, SelectBuilder, UpdateBuilder}\n\ntrait AddressRepo {\n  def delete: DeleteBuilder[AddressFields, AddressRow]\n  def deleteById(addressid: AddressId)(implicit c: Connection): Boolean\n  def deleteByIds(addressids: Array[AddressId])(implicit c: Connection): Int\n  def insert(unsaved: AddressRow)(implicit c: Connection): AddressRow\n  def insert(unsaved: AddressRowUnsaved)(implicit c: Connection): AddressRow\n  def insertStreaming(unsaved: Iterator[AddressRow], batchSize: Int)(implicit c: Connection): Long\n  /* NOTE: this functionality requires PostgreSQL 16 or later! */\n  def insertUnsavedStreaming(unsaved: Iterator[AddressRowUnsaved], batchSize: Int)(implicit c: Connection): Long\n  def select: SelectBuilder[AddressFields, AddressRow]\n  def selectAll(implicit c: Connection): List[AddressRow]\n  def selectById(addressid: AddressId)(implicit c: Connection): Option[AddressRow]\n  def selectByIds(addressids: Array[AddressId])(implicit c: Connection): List[AddressRow]\n  def selectByIdsTracked(addressids: Array[AddressId])(implicit c: Connection): Map[AddressId, Option[AddressRow]]\n  def update: UpdateBuilder[AddressFields, AddressRow]\n  def update(row: AddressRow)(implicit c: Connection): Boolean\n  def upsert(unsaved: AddressRow)(implicit c: Connection): AddressRow\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"simplified-insertion",children:"Simplified Insertion"}),"\n",(0,t.jsx)(n.p,{children:"Since Typo understands auto-increment IDs and default values, you can effortlessly insert new rows\nwithout the need for complex code. A special structure is provided for creating unsaved rows with default values."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:"import adventureworks.customtypes.Defaulted\n\n\n/** This class corresponds to a row in table `person.address` which has not been persisted yet */\ncase class AddressRowUnsaved(\n  /** First street address line. */\n  addressline1: /* max 60 chars */ String,\n  /** Second street address line. */\n  addressline2: Option[/* max 60 chars */ String],\n  /** Name of the city. */\n  city: /* max 30 chars */ String,\n  /** Unique identification number for the state or province. Foreign key to StateProvince table.\n      Points to [[stateprovince.StateprovinceRow.stateprovinceid]] */\n  stateprovinceid: StateprovinceId,\n  /** Postal code for the street address. */\n  postalcode: /* max 15 chars */ String,\n  /** Latitude and longitude of this address. */\n  spatiallocation: Option[TypoBytea],\n  /** Default: nextval('person.address_addressid_seq'::regclass)\n      Primary key for Address records. */\n  addressid: Defaulted[AddressId] = Defaulted.UseDefault,\n  /** Default: uuid_generate_v1() */\n  rowguid: Defaulted[TypoUUID] = Defaulted.UseDefault,\n  /** Default: now() */\n  modifieddate: Defaulted[TypoLocalDateTime] = Defaulted.UseDefault\n)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"readonly-repositories",children:"Readonly repositories"}),"\n",(0,t.jsxs)(n.p,{children:["If you have a bunch of tables you just want to read, you can ",(0,t.jsx)(n.a,{href:"/typo/docs/customization/overview",children:"customize"}),"\nthe repositories to only expose read methods."]}),"\n",(0,t.jsx)(n.h2,{id:"views",children:"Views"}),"\n",(0,t.jsx)(n.p,{children:"Typo also excels at simplifying code generation for views.\nWhile less code is generated for views, it's still designed to make your life easier"}),"\n",(0,t.jsx)(n.p,{children:"So given the following view:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"create view vemployee\n            (businessentityid, title, firstname, middlename, lastname, suffix, jobtitle, phonenumber, phonenumbertype,\n             emailaddress, emailpromotion, addressline1, addressline2, city, stateprovincename, postalcode,\n             countryregionname, additionalcontactinfo)\nas\nSELECT e.businessentityid,\n       p.title,\n       p.firstname,\n       p.middlename,\n       p.lastname,\n       p.suffix,\n       e.jobtitle,\n       pp.phonenumber,\n       pnt.name AS phonenumbertype,\n       ea.emailaddress,\n       p.emailpromotion,\n       a.addressline1,\n       a.addressline2,\n       a.city,\n       sp.name  AS stateprovincename,\n       a.postalcode,\n       cr.name  AS countryregionname,\n       p.additionalcontactinfo\nFROM humanresources.employee e\n         JOIN person.person p ON p.businessentityid = e.businessentityid\n         JOIN person.businessentityaddress bea ON bea.businessentityid = e.businessentityid\n         JOIN person.address a ON a.addressid = bea.addressid\n         JOIN person.stateprovince sp ON sp.stateprovinceid = a.stateprovinceid\n         JOIN person.countryregion cr ON cr.countryregioncode::text = sp.countryregioncode::text\n         LEFT JOIN person.personphone pp ON pp.businessentityid = p.businessentityid\n         LEFT JOIN person.phonenumbertype pnt ON pp.phonenumbertypeid = pnt.phonenumbertypeid\n         LEFT JOIN person.emailaddress ea ON p.businessentityid = ea.businessentityid;\n\n"})}),"\n",(0,t.jsx)(n.p,{children:"You get the following row type:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:"import adventureworks.customtypes.TypoXml\nimport adventureworks.person.businessentity.BusinessentityId\nimport adventureworks.public.Name\nimport adventureworks.public.Phone\nimport adventureworks.userdefined.FirstName\n\n/** View: humanresources.vemployee */\ncase class VemployeeViewRow(\n  /** Points to [[employee.EmployeeRow.businessentityid]] */\n  businessentityid: BusinessentityId,\n  /** Points to [[person.person.PersonRow.title]] */\n  title: Option[/* max 8 chars */ String],\n  /** Points to [[person.person.PersonRow.firstname]] */\n  firstname: /* user-picked */ FirstName,\n  /** Points to [[person.person.PersonRow.middlename]] */\n  middlename: Option[Name],\n  /** Points to [[person.person.PersonRow.lastname]] */\n  lastname: Name,\n  /** Points to [[person.person.PersonRow.suffix]] */\n  suffix: Option[/* max 10 chars */ String],\n  /** Points to [[employee.EmployeeRow.jobtitle]] */\n  jobtitle: /* max 50 chars */ String,\n  /** Points to [[person.personphone.PersonphoneRow.phonenumber]] */\n  phonenumber: Option[Phone],\n  /** Points to [[person.phonenumbertype.PhonenumbertypeRow.name]] */\n  phonenumbertype: Option[Name],\n  /** Points to [[person.emailaddress.EmailaddressRow.emailaddress]] */\n  emailaddress: Option[/* max 50 chars */ String],\n  /** Points to [[person.person.PersonRow.emailpromotion]] */\n  emailpromotion: Int,\n  /** Points to [[person.address.AddressRow.addressline1]] */\n  addressline1: /* max 60 chars */ String,\n  /** Points to [[person.address.AddressRow.addressline2]] */\n  addressline2: Option[/* max 60 chars */ String],\n  /** Points to [[person.address.AddressRow.city]] */\n  city: /* max 30 chars */ String,\n  /** Points to [[person.stateprovince.StateprovinceRow.name]] */\n  stateprovincename: Name,\n  /** Points to [[person.address.AddressRow.postalcode]] */\n  postalcode: /* max 15 chars */ String,\n  /** Points to [[person.countryregion.CountryregionRow.name]] */\n  countryregionname: Name,\n  /** Points to [[person.person.PersonRow.additionalcontactinfo]] */\n  additionalcontactinfo: Option[TypoXml]\n)\n"})}),"\n",(0,t.jsx)(n.p,{children:"And this repository interface, focused on selecting rows from the view."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-scala",children:"import adventureworks.humanresources.vemployee.{VemployeeViewFields, VemployeeViewRow}\n\ntrait VemployeeViewRepo {\n  def select: SelectBuilder[VemployeeViewFields, VemployeeViewRow]\n  def selectAll(implicit c: Connection): List[VemployeeViewRow]\n}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var t=s(6540);const o={},i=t.createContext(o);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);