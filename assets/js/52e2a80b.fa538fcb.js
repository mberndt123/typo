"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[12],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var d=r.createContext({}),l=function(e){var t=r.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=l(e.components);return r.createElement(d.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},f=r.forwardRef((function(e,t){var n=e.components,s=e.mdxType,a=e.originalType,d=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=l(n),f=s,m=u["".concat(d,".").concat(f)]||u[f]||p[f]||a;return n?r.createElement(m,o(o({ref:t},c),{},{components:n})):r.createElement(m,o({ref:t},c))}));function m(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var a=n.length,o=new Array(a);o[0]=f;var i={};for(var d in t)hasOwnProperty.call(t,d)&&(i[d]=t[d]);i.originalType=e,i[u]="string"==typeof e?e:s,o[1]=i;for(var l=2;l<a;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}f.displayName="MDXCreateElement"},6861:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var r=n(7462),s=(n(7294),n(3905));const a={title:"Typed postgres for Scala"},o=void 0,i={unversionedId:"readme",id:"readme",title:"Typed postgres for Scala",description:"First things first:",source:"@site/docs/readme.md",sourceDirName:".",slug:"/",permalink:"/typo/docs/",draft:!1,tags:[],version:"current",frontMatter:{title:"Typed postgres for Scala"},sidebar:"tutorialSidebar",next:{title:"SQL is king!",permalink:"/typo/docs/what-is/sql-is-king"}},d={},l=[{value:"We&#39;re doing it all wrong.",id:"were-doing-it-all-wrong",level:2},{value:"What is <code>typo</code>?",id:"what-is-typo",level:2},{value:"Motivation",id:"motivation",level:2},{value:"Build safer systems",id:"build-safer-systems",level:3},{value:"Write less boilerplate code",id:"write-less-boilerplate-code",level:3},{value:"SQL is king!",id:"sql-is-king",level:2},{value:"And way more",id:"and-way-more",level:2},{value:"Tables",id:"tables",level:2}],c={toc:l},u="wrapper";function p(e){let{components:t,...n}=e;return(0,s.kt)(u,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"First things first:"),(0,s.kt)("h2",{id:"were-doing-it-all-wrong"},"We're doing it all wrong."),(0,s.kt)("p",null,"We're integrating with postgres in a backwards way. Time to make it right!"),(0,s.kt)("h2",{id:"what-is-typo"},"What is ",(0,s.kt)("inlineCode",{parentName:"h2"},"typo"),"?"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"typo")," is a source code generator which uses postgres schema definitions and your sql definitions as sources of truth. "),(0,s.kt)("p",null,"With a razor-sharp focus on type-safety and DX, hopefully you'll find the experience very pleasant."),(0,s.kt)("p",null,"Read on to discover what's here! :)"),(0,s.kt)("h2",{id:"motivation"},"Motivation"),(0,s.kt)("h3",{id:"build-safer-systems"},"Build safer systems"),(0,s.kt)("p",null,"We use the compiler to verify our programs. All is great, until you need to interact with the messy outside world."),(0,s.kt)("p",null,"One of the best tools we have available to help the compiler verify our interactions with the outside world is contract-driven development."),(0,s.kt)("p",null,"Say an API is described by an OpenApi definition.\nIf you use that to generate code for the HTTP layer you guarantee that you implement it correctly because otherwise the compiler can help you!"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"typo")," intends to provide the same safety in the database layer.\nIt does this by generating correct code for all your tables, views and queries based on postgres metadata tables."),(0,s.kt)("h3",{id:"write-less-boilerplate-code"},"Write less boilerplate code"),(0,s.kt)("p",null,"No more redefining basic crud-operations, writing fragile row mappers, tolerating quirky string interpolation functionality and so on."),(0,s.kt)("h2",{id:"sql-is-king"},"SQL is king!"),(0,s.kt)("h2",{id:"and-way-more"},"And way more"),(0,s.kt)("h2",{id:"tables"},"Tables"),(0,s.kt)("p",null,"Given a table like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-sql"},"create table address\n(\n    addressid       serial\n        constraint \"PK_Address_AddressID\" primary key,\n    addressline1    varchar(60)                          not null,\n    addressline2    varchar(60),\n    city            varchar(30)                          not null,\n    stateprovinceid integer                              not null \n        constraint \"FK_Address_StateProvince_StateProvinceID\" references stateprovince,\n    postalcode      varchar(15)                          not null,\n    spatiallocation bytea,\n    rowguid         uuid      default uuid_generate_v1() not null,\n    modifieddate    timestamp default now()              not null\n);\n\ncomment on table address is 'Street address information for customers, employees, and vendors.';\ncomment on column address.addressid is 'Primary key for Address records.';\ncomment on column address.addressline1 is 'First street address line.';\ncomment on column address.addressline2 is 'Second street address line.';\ncomment on column address.city is 'Name of the city.';\ncomment on column address.stateprovinceid is 'Unique identification number for the state or province. Foreign key to StateProvince table.';\ncomment on column address.postalcode is 'Postal code for the street address.';\ncomment on column address.spatiallocation is 'Latitude and longitude of this address.';\n")),(0,s.kt)("p",null,"You'll get a row class like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-scala"},"case class AddressRow(\n  /** Primary key for Address records. */\n  addressid: AddressId,\n  /** First street address line. */\n  addressline1: String,\n  /** Second street address line. */\n  addressline2: Option[String],\n  /** Name of the city. */\n  city: String,\n  /** Unique identification number for the state or province. Foreign key to StateProvince table.\n      Points to [[stateprovince.StateprovinceRow.stateprovinceid]] */\n  stateprovinceid: StateprovinceId,\n  /** Postal code for the street address. */\n  postalcode: String,\n  /** Latitude and longitude of this address. */\n  spatiallocation: Option[Array[Byte]],\n  rowguid: UUID,\n  modifieddate: LocalDateTime\n)\n\n")),(0,s.kt)("p",null,"and a repo like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-scala"},"trait AddressRepo {\n  def delete(addressid: AddressId): ConnectionIO[Boolean]\n  def insert(unsaved: AddressRow): ConnectionIO[AddressRow]\n  def insert(unsaved: AddressRowUnsaved): ConnectionIO[AddressRow]\n  def selectAll: Stream[ConnectionIO, AddressRow]\n  def selectByFieldValues(fieldValues: List[AddressFieldOrIdValue[_]]): Stream[ConnectionIO, AddressRow]\n  def selectById(addressid: AddressId): ConnectionIO[Option[AddressRow]]\n  def selectByIds(addressids: Array[AddressId]): Stream[ConnectionIO, AddressRow]\n  def update(row: AddressRow): ConnectionIO[Boolean]\n  def updateFieldValues(addressid: AddressId, fieldValues: List[AddressFieldValue[_]]): ConnectionIO[Boolean]\n  def upsert(unsaved: AddressRow): ConnectionIO[AddressRow]\n}\n")),(0,s.kt)("p",null,"Since the table has auto-increment ID and default values, you will typically use this structure to insert new rows"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-scala"},"/** This class corresponds to a row in table `person.address` which has not been persisted yet */\ncase class AddressRowUnsaved(\n  /** First street address line. */\n  addressline1: String,\n  /** Second street address line. */\n  addressline2: Option[String],\n  /** Name of the city. */\n  city: String,\n  /** Unique identification number for the state or province. Foreign key to StateProvince table.\n      Points to [[stateprovince.StateprovinceRow.stateprovinceid]] */\n  stateprovinceid: StateprovinceId,\n  /** Postal code for the street address. */\n  postalcode: String,\n  /** Latitude and longitude of this address. */\n  spatiallocation: Option[Array[Byte]],\n  /** Default: nextval('person.address_addressid_seq'::regclass)\n      Primary key for Address records. */\n  addressid: Defaulted[AddressId] = Defaulted.UseDefault,\n  /** Default: uuid_generate_v1() */\n  rowguid: Defaulted[UUID] = Defaulted.UseDefault,\n  /** Default: now() */\n  modifieddate: Defaulted[LocalDateTime] = Defaulted.UseDefault\n)\n")))}p.isMDXComponent=!0}}]);