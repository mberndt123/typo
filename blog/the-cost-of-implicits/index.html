<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">The compilation cost of implicits | Typo</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://oyvindberg.github.io/typo/blog/the-cost-of-implicits/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="The compilation cost of implicits | Typo"><meta data-rh="true" name="description" content="The compilation cost of implicits"><meta data-rh="true" property="og:description" content="The compilation cost of implicits"><meta data-rh="true" property="og:image" content="https://i.imgur.com/mErPwqL.png"><meta data-rh="true" name="twitter:image" content="https://i.imgur.com/mErPwqL.png"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-12-17T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/oyvindberg"><meta data-rh="true" property="article:tag" content="typo,scala,doobie,anorm,zio-jdbc,implicits,compile-times"><link data-rh="true" rel="icon" href="/typo/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://oyvindberg.github.io/typo/blog/the-cost-of-implicits/"><link data-rh="true" rel="alternate" href="https://oyvindberg.github.io/typo/blog/the-cost-of-implicits/" hreflang="en"><link data-rh="true" rel="alternate" href="https://oyvindberg.github.io/typo/blog/the-cost-of-implicits/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://oyvindberg.github.io/typo/blog/the-cost-of-implicits","mainEntityOfPage":"https://oyvindberg.github.io/typo/blog/the-cost-of-implicits","url":"https://oyvindberg.github.io/typo/blog/the-cost-of-implicits","headline":"The compilation cost of implicits","name":"The compilation cost of implicits","description":"The compilation cost of implicits","datePublished":"2023-12-17T00:00:00.000Z","author":{"@type":"Person","name":"Øyvind Raddum Berg","url":"https://github.com/oyvindberg","image":"https://github.com/oyvindberg.png"},"image":{"@type":"ImageObject","@id":"https://i.imgur.com/mErPwqL.png","url":"https://i.imgur.com/mErPwqL.png","contentUrl":"https://i.imgur.com/mErPwqL.png","caption":"title image for the blog post: The compilation cost of implicits"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://oyvindberg.github.io/typo/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/typo/blog/rss.xml" title="Typo RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/typo/blog/atom.xml" title="Typo Atom Feed"><link rel="stylesheet" href="/typo/assets/css/styles.1266b40a.css">
<script src="/typo/assets/js/runtime~main.e20e5bc0.js" defer="defer"></script>
<script src="/typo/assets/js/main.862b6be9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/typo/"><div class="navbar__logo"><img src="/typo/img/logo.svg" alt="Typo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/typo/img/logo.svg" alt="Typo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Typo</b></a><a class="navbar__item navbar__link" href="/typo/docs/">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/typo/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oyvindberg/typo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/typo/blog/the-cost-of-implicits/">The compilation cost of implicits</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/typo/blog/hello-zio/">Hello, ZIO</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">The compilation cost of implicits</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-12-17T00:00:00.000Z">December 17, 2023</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/oyvindberg" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/oyvindberg.png" alt="Øyvind Raddum Berg"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/oyvindberg" target="_blank" rel="noopener noreferrer"><span>Øyvind Raddum Berg</span></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>I&#x27;ve accidentally built a compilation benchmark harness for Scala 2 and 3 which can measure the cost (in compilation time)
for having a codebase full of implicits which need to be resolved. Read on to see the results!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h2>
<p>Typo is a code-generation library for working with PostgreSQL in Scala.
You can read more in the <a href="https://oyvindberg.github.io/typo/docs/" target="_blank" rel="noopener noreferrer">introduction</a>.</p>
<p>It was built to replace huge swathes of boilerplate in applications,
as well as to provide sorely needed type-safety to avoid having to test everything.</p>
<p>A crucial design goal was to fit into your system such as it is.
This means it generates code in the shared subset between Scala 2.12, 2.13 and 3.x,
and for three different database access libraries.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="typo-output-as-a-realistic-compile-speed-test-harness">Typo output as a realistic compile speed test harness<a href="#typo-output-as-a-realistic-compile-speed-test-harness" class="hash-link" aria-label="Direct link to Typo output as a realistic compile speed test harness" title="Direct link to Typo output as a realistic compile speed test harness">​</a></h3>
<p>In typical systems you may have a database layer, a business logic layer and a web layer,
with each of them occupying about a third of the code base.</p>
<p>The structure of the database and web layers are often very similar -
basically a bunch of case classes with type class instances and mapping code.</p>
<p>So let&#x27;s say we take the database third of a typical system.
We&#x27;ll use the fact that Typo can generate it in its entirety to build a compile speed benchmark,
where we contrast different combinations of scala versions and database libraries.</p>
<p>I&#x27;ll stress that the code it generates is basically the same code I&#x27;ve written again and again over the years,
which should make the benchmark interesting since this is so close to real-world application code.</p>
<p>Let&#x27;s see where it takes us!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-generated-code">The generated code<a href="#the-generated-code" class="hash-link" aria-label="Direct link to The generated code" title="Direct link to The generated code">​</a></h2>
<p>If you&#x27;re curious about the generated code,
you can expand this section to see some example code
for an email address table in the <a href="https://github.com/lorint/AdventureWorks-for-Postgres" target="_blank" rel="noopener noreferrer">AdventureWorks database</a>,
generated for doobie.</p>
<!-- -->
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>EmailaddressId.scala</summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/</span><span class="token important">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * File has been automatically generated by `typo`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package adventureworks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package emailaddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import adventureworks.person.businessentity.BusinessentityId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/</span><span class="token important">**</span><span class="token plain"> Type for the composite primary key of table `person.emailaddress` </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">case class EmailaddressId(businessentityid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BusinessentityId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">emailaddressid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Int)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object EmailaddressId </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">implicit lazy val ordering</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Ordering</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressId</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = Ordering.by(x =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> (x.businessentityid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x.emailaddressid))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>EmailaddressRepo.scala</summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/</span><span class="token important">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * File has been automatically generated by `typo`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package adventureworks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package emailaddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import doobie.free.connection.ConnectionIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import fs2.Stream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.DeleteBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.SelectBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.UpdateBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">trait EmailaddressRepo </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">def delete(compositeId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressId)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Boolean</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">def delete</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DeleteBuilder</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">def insert(unsaved</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressRow)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">def insert(unsaved</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressRowUnsaved)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">def select</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SelectBuilder</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">def selectAll</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Stream</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ConnectionIO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">def selectById(compositeId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressId)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Option</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">def update(row</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressRow)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Boolean</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">def update</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> UpdateBuilder</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">def upsert(unsaved</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressRow)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>EmailaddressRepoImpl.scala</summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/</span><span class="token important">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * File has been automatically generated by `typo`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package adventureworks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package emailaddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import adventureworks.customtypes.Defaulted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import adventureworks.customtypes.TypoLocalDateTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import adventureworks.customtypes.TypoUUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import doobie.free.connection.ConnectionIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import doobie.syntax.string.toSqlInterpolator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import doobie.util.fragment.Fragment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import fs2.Stream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.DeleteBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.SelectBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.SelectBuilderSql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.UpdateBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class EmailaddressRepoImpl extends EmailaddressRepo </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def delete(compositeId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressId)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Boolean</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sql&quot;&quot;&quot;delete from person.emailaddress where &quot;businessentityid&quot; = $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">compositeId.businessentityid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> AND &quot;emailaddressid&quot; = $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">compositeId.emailaddressid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;&quot;&quot;.update.run.map(_ </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def delete</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DeleteBuilder</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DeleteBuilder(&quot;person.emailaddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressFields)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def insert(unsaved</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressRow)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sql&quot;&quot;&quot;insert into person.emailaddress(&quot;businessentityid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddressid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rowguid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &quot;modifieddate&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          values ($</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.businessentityid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">int4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.emailaddressid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">int4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.emailaddress</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.rowguid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">uuid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.modifieddate</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">timestamp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          returning &quot;businessentityid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddressid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rowguid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &quot;modifieddate&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &quot;&quot;&quot;.query(EmailaddressRow.read).unique</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def insert(unsaved</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressRowUnsaved)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val fs = List(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Some((Fragment.const(s&quot;&quot;&quot;&quot;businessentityid&quot;&quot;&quot;&quot;)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fr&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.businessentityid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">int4&quot;))</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Some((Fragment.const(s&quot;&quot;&quot;&quot;emailaddress&quot;&quot;&quot;&quot;)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fr&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.emailaddress</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;))</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      unsaved.emailaddressid match </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case Defaulted.UseDefault =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case Defaulted.Provided(value) =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> Some((Fragment.const(s&quot;&quot;&quot;&quot;emailaddressid&quot;&quot;&quot;&quot;)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fr&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Int</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">int4&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      unsaved.rowguid match </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case Defaulted.UseDefault =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case Defaulted.Provided(value) =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> Some((Fragment.const(s&quot;&quot;&quot;&quot;rowguid&quot;&quot;&quot;&quot;)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fr&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TypoUUID</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">uuid&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      unsaved.modifieddate match </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case Defaulted.UseDefault =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case Defaulted.Provided(value) =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> Some((Fragment.const(s&quot;&quot;&quot;&quot;modifieddate&quot;&quot;&quot;&quot;)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fr&quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TypoLocalDateTime</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">timestamp&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ).flatten</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val q = if (fs.isEmpty) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sql&quot;&quot;&quot;insert into person.emailaddress default values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            returning &quot;businessentityid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddressid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rowguid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &quot;modifieddate&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> else </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val CommaSeparate = Fragment.FragmentMonoid.intercalate(fr&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sql&quot;&quot;&quot;insert into person.emailaddress($</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">CommaSeparate.combineAllOption(fs.map </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> case (n</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _) =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> n </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">).get</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            values ($</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">CommaSeparate.combineAllOption(fs.map </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> case (_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> f) =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> f </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">).get</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            returning &quot;businessentityid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddressid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rowguid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &quot;modifieddate&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    q.query(EmailaddressRow.read).unique</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def select</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SelectBuilder</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SelectBuilderSql(&quot;person.emailaddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow.read)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def selectAll</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Stream</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ConnectionIO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sql&quot;&quot;&quot;select &quot;businessentityid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddressid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rowguid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &quot;modifieddate&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">text from person.emailaddress&quot;&quot;&quot;.query(EmailaddressRow.read).stream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def selectById(compositeId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressId)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Option</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sql&quot;&quot;&quot;select &quot;businessentityid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddressid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rowguid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &quot;modifieddate&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">text from person.emailaddress where &quot;businessentityid&quot; = $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">compositeId.businessentityid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> AND &quot;emailaddressid&quot; = $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">compositeId.emailaddressid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;&quot;&quot;.query(EmailaddressRow.read).option</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def update(row</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressRow)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Boolean</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val compositeId = row.compositeId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sql&quot;&quot;&quot;update person.emailaddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          set &quot;emailaddress&quot; = $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">row.emailaddress</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;rowguid&quot; = $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">row.rowguid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">uuid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;modifieddate&quot; = $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">row.modifieddate</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          where &quot;businessentityid&quot; = $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">compositeId.businessentityid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> AND &quot;emailaddressid&quot; = $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">compositeId.emailaddressid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .map(_ </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def update</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> UpdateBuilder</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UpdateBuilder(&quot;person.emailaddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow.read)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def upsert(unsaved</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressRow)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sql&quot;&quot;&quot;insert into person.emailaddress(&quot;businessentityid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddressid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rowguid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &quot;modifieddate&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          values (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.businessentityid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">int4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.emailaddressid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">int4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.emailaddress</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.rowguid</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">uuid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.modifieddate</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          on conflict (&quot;businessentityid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &quot;emailaddressid&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          do update set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;emailaddress&quot; = EXCLUDED.&quot;emailaddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;rowguid&quot; = EXCLUDED.&quot;rowguid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;modifieddate&quot; = EXCLUDED.&quot;modifieddate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          returning &quot;businessentityid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddressid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emailaddress&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rowguid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> &quot;modifieddate&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &quot;&quot;&quot;.query(EmailaddressRow.read).unique</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>EmailaddressRepoMock.scala</summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/</span><span class="token important">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * File has been automatically generated by `typo`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package adventureworks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package emailaddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import doobie.free.connection.ConnectionIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import doobie.free.connection.delay</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import fs2.Stream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import scala.annotation.nowarn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.DeleteBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.DeleteBuilder.DeleteBuilderMock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.DeleteParams</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.SelectBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.SelectBuilderMock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.SelectParams</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.UpdateBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.UpdateBuilder.UpdateBuilderMock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import typo.dsl.UpdateParams</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">class EmailaddressRepoMock(toRow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Function1</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRowUnsaved</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           </span><span class="token key atrule" style="color:#00a4db">map</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> scala.collection.mutable.Map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = scala.collection.mutable.Map.empty) extends EmailaddressRepo </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def delete(compositeId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressId)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Boolean</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delay(map.remove(compositeId).isDefined)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def delete</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DeleteBuilder</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DeleteBuilderMock(DeleteParams.empty</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> map)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def insert(unsaved</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressRow)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delay </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      val _ = if (map.contains(unsaved.compositeId))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sys.error(s&quot;id $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">unsaved.compositeId</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> already exists&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        map.put(unsaved.compositeId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> unsaved)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      unsaved</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def insert(unsaved</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressRowUnsaved)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insert(toRow(unsaved))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def select</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SelectBuilder</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SelectBuilderMock(EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> delay(map.values.toList)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SelectParams.empty)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def selectAll</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Stream</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ConnectionIO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Stream.emits(map.values.toList)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def selectById(compositeId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressId)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Option</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delay(map.get(compositeId))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def update(row</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressRow)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Boolean</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delay </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      map.get(row.compositeId) match </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case Some(`row`) =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case Some(_) =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          map.put(row.compositeId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">row)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> @nowarn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case None =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def update</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> UpdateBuilder</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    UpdateBuilderMock(UpdateParams.empty</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EmailaddressFields</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> map)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">override def upsert(unsaved</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">EmailaddressRow)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConnectionIO</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delay </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      map.put(unsaved.compositeId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">unsaved)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> @nowarn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      unsaved</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>EmailaddressRow.scala</summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/</span><span class="token important">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * File has been automatically generated by `typo`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package adventureworks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package emailaddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import adventureworks.customtypes.TypoLocalDateTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import adventureworks.customtypes.TypoUUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import adventureworks.person.businessentity.BusinessentityId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import doobie.enumerated.Nullability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import doobie.util.Get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import doobie.util.Read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.sql.ResultSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case class EmailaddressRow(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /</span><span class="token important">**</span><span class="token plain"> Primary key. Person associated with this email address.  Foreign key to Person.BusinessEntityID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Points to </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">person.PersonRow.businessentityid</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">businessentityid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BusinessentityId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /</span><span class="token important">**</span><span class="token plain"> Primary key. ID of this email address. </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">emailaddressid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /</span><span class="token important">**</span><span class="token plain"> E</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mail address for the person. </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">emailaddress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Option</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">/* max 50 chars </span><span class="token important">*/</span><span class="token plain"> String</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rowguid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TypoUUID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">modifieddate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TypoLocalDateTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token key atrule" style="color:#00a4db">val compositeId</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> EmailaddressId = EmailaddressId(businessentityid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> emailaddressid)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">object EmailaddressRow </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">implicit lazy val read</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Read</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    new Read</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">EmailaddressRow</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      gets = List(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Get</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">BusinessentityId</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nullability.NoNulls)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Get</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nullability.NoNulls)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Get</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">/* max 50 chars </span><span class="token important">*/</span><span class="token plain"> String</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nullability.Nullable)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Get</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TypoUUID</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nullability.NoNulls)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Get</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TypoLocalDateTime</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Nullability.NoNulls)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      )</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">unsafeGet = (rs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ResultSet</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">i</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Int) =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> EmailaddressRow(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        businessentityid = Get</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">BusinessentityId</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.unsafeGetNonNullable(rs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i + 0)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        emailaddressid = Get</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.unsafeGetNonNullable(rs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i + 1)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        emailaddress = Get</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">/* max 50 chars </span><span class="token important">*/</span><span class="token plain"> String</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.unsafeGetNullable(rs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i + 2)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rowguid = Get</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TypoUUID</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.unsafeGetNonNullable(rs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i + 3)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        modifieddate = Get</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TypoLocalDateTime</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.unsafeGetNonNullable(rs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i + 4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>EmailaddressRowUnsaved.scala</summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/</span><span class="token important">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * File has been automatically generated by `typo`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * IF YOU CHANGE THIS FILE YOUR CHANGES WILL BE OVERWRITTEN.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package adventureworks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package emailaddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import adventureworks.customtypes.Defaulted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import adventureworks.customtypes.TypoLocalDateTime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import adventureworks.customtypes.TypoUUID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import adventureworks.person.businessentity.BusinessentityId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/</span><span class="token important">**</span><span class="token plain"> This class corresponds to a row in table `person.emailaddress` which has not been persisted yet </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">case class EmailaddressRowUnsaved(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /</span><span class="token important">**</span><span class="token plain"> Primary key. Person associated with this email address.  Foreign key to Person.BusinessEntityID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * Points to </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">person.PersonRow.businessentityid</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">businessentityid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> BusinessentityId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /</span><span class="token important">**</span><span class="token plain"> E</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">mail address for the person. </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">emailaddress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Option</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">/* max 50 chars </span><span class="token important">*/</span><span class="token plain"> String</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">/** Default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nextval(&#x27;person.emailaddress_emailaddressid_seq&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">regclass)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * Primary key. ID of this email address.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">emailaddressid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Defaulted</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = Defaulted.UseDefault</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">/** Default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> uuid_generate_v1() </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rowguid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Defaulted</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TypoUUID</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = Defaulted.UseDefault</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">/** Default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> now() </span><span class="token important">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">modifieddate</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Defaulted</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">TypoLocalDateTime</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> = Defaulted.UseDefault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">def toRow(emailaddressidDefault</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> Int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">rowguidDefault</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> TypoUUID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">modifieddateDefault</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">=&gt; TypoLocalDateTime)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> EmailaddressRow =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EmailaddressRow(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      businessentityid = businessentityid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      emailaddress = emailaddress</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      emailaddressid = emailaddressid match </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         case Defaulted.UseDefault =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> emailaddressidDefault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         case Defaulted.Provided(value) =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rowguid = rowguid match </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  case Defaulted.UseDefault =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> rowguidDefault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  case Defaulted.Provided(value) =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      modifieddate = modifieddate match </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       case Defaulted.UseDefault =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> modifieddateDefault</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       case Defaulted.Provided(value) =</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details>
<p>In total it&#x27;s about this much:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Language             Files        Lines        Blank      Comment         Code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Scala                 1052        47011         3215         7436        36360</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="initial-comparison-of-compile-times">Initial comparison of compile times<a href="#initial-comparison-of-compile-times" class="hash-link" aria-label="Direct link to Initial comparison of compile times" title="Direct link to Initial comparison of compile times">​</a></h2>
<p>Each benchmark is run three times, and in the graphs you can choose to see minimum or average compile times.</p>
<div style="width:80%;margin:auto"><select id="toggleView"><option value="min" selected="">Minimum Compile Time</option><option value="avg">Average Compile Time</option></select><div class="chart-container"><canvas id="groupedBarChart1" width="800" height="400"></canvas></div></div>
<p>&quot;baseline&quot; is generating just case classes, no type class instances or repositories.</p>
<p>We can make some observations right away:</p>
<ul>
<li>Scala 3 is ~always faster than Scala 2.12 and 2.13, only beaten by Scala 2.12 for baseline/just case classes</li>
<li>doobie takes more than double the time to compile compared to anorm and zio-jdbc for Scala 2.x.</li>
<li>zio-jdbc and anorm have similar compile times across scala versions.</li>
<li>It&#x27;s interesting to see the &quot;cost&quot; of adding type class instances and repositories</li>
</ul>
<br>
<div style="background-color:#f0f0f0;color:#000;padding:20px;border-radius:8px;display:flex;align-items:center;justify-content:center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:10px"><path d="M7 20v1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1"></path><path d="M9 20h6"></path><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 16h-2v-2h2v2zm0-4h-2V8h2v6z"></path></svg><span>Key takeaway: <p>Scala 3 is consistently fast! Great job Scala team!</p></span></div>
<br>
<p>The meat of this blog post will be to <b>investigate why the code for doobie takes so long for scala 2.x</b>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="so-whats-up-with-doobie-with-scala-2x">So what&#x27;s up with doobie with Scala 2.x?<a href="#so-whats-up-with-doobie-with-scala-2x" class="hash-link" aria-label="Direct link to So what&#x27;s up with doobie with Scala 2.x?" title="Direct link to So what&#x27;s up with doobie with Scala 2.x?">​</a></h2>
<p>The issue is composite. Let&#x27;s take the biggest issue first - Automatic derivation of type class instances!</p>
<p>Let&#x27;s take something rather innocent:</p>
<div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> A</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">v1</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v2</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v3</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v4</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v5</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v6</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v7</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">String</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string-interpolation id function" style="color:#d73a49">sql</span><span class="token string-interpolation string" style="color:#e3116c">&quot;select 1,2,3,4,5,6,7&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">List</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string-interpolation id function" style="color:#d73a49">sql</span><span class="token string-interpolation string" style="color:#e3116c">&quot;select 1,2,3,4,5,6,7&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">List</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will compile and work, but an instance of <code>Read[A]</code> will be derived for each of the two queries.</p>
<p>No problem, we&#x27;re taught that we can cache the <code>Read[A]</code> instance in the companion object.</p>
<div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">object</span><span class="token plain"> A </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">implicit</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">val</span><span class="token plain"> read</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Read</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Read</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">derived</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The surprise is that (as far as I understand) this does not actually work in this case.
Since the automatic derivation is put in implicit scope in the companion object of the type class, it will be found before our cached instance.
We actually need to specify the instance explicitly:</p>
<div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string-interpolation id function" style="color:#d73a49">sql</span><span class="token string-interpolation string" style="color:#e3116c">&quot;select 1,2,3,4,5,6,7&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">List</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string-interpolation id function" style="color:#d73a49">sql</span><span class="token string-interpolation string" style="color:#e3116c">&quot;select 1,2,3,4,5,6,7&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">List</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And boom! We&#x27;ve solved the problem. I implemented this in Typo, and will refer to this as doobie with and without fix in subsequent tables.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="results-without-accidental-automatic-type-class-derivation-for-doobie">Results without accidental automatic type class derivation for doobie<a href="#results-without-accidental-automatic-type-class-derivation-for-doobie" class="hash-link" aria-label="Direct link to Results without accidental automatic type class derivation for doobie" title="Direct link to Results without accidental automatic type class derivation for doobie">​</a></h2>
<div style="width:80%;margin:auto"><select id="toggleView"><option value="min" selected="">Minimum Compile Time</option><option value="avg">Average Compile Time</option></select><div class="chart-container"><canvas id="groupedBarChart2" width="800" height="400"></canvas></div></div>
<p>Fantastic! We&#x27;ve cut the compile times almost in half for doobie for Scala 2.x - ten seconds is a lot of time if you suffer them often.</p>
<br>
<div style="background-color:#f0f0f0;color:#000;padding:20px;border-radius:8px;display:flex;align-items:center;justify-content:center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:10px"><path d="M7 20v1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1"></path><path d="M9 20h6"></path><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 16h-2v-2h2v2zm0-4h-2V8h2v6z"></path></svg><span>Key takeaway: <p>Automatic typeclass derivation is a bad idea, but only for Scala 2.x!</p></span></div>
<br>
<p>But doobie is still a lot slower, so let&#x27;s dig a bit further!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="query-interpolation-woes">Query interpolation woes.<a href="#query-interpolation-woes" class="hash-link" aria-label="Direct link to Query interpolation woes." title="Direct link to Query interpolation woes.">​</a></h2>
<p>So all of this extra time is spent in typer/resolving implicits. I wanted to see what could be done about it, and what causes it.</p>
<p>That&#x27;s why I implemented an &quot;inline implicits&quot; mode for typo. I&#x27;ll show a diff of what it does here, hopefully it&#x27;ll be clear that it hardcodes some implicit resolution:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+import doobie.syntax.SqlInterpolator.SingleFragment.fromWrite</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+import doobie.util.Write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+import doobie.util.meta.Meta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class EmailaddressRepoImpl extends EmailaddressRepo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   override def update(row: EmailaddressRow): ConnectionIO[Boolean] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     val compositeId = row.compositeId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     sql&quot;&quot;&quot;update person.emailaddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-          set &quot;emailaddress&quot; = ${row.emailaddress},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-              &quot;rowguid&quot; = ${row.rowguid}::uuid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-              &quot;modifieddate&quot; = ${row.modifieddate}::timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-          where &quot;businessentityid&quot; = ${compositeId.businessentityid} AND &quot;emailaddressid&quot; = ${compositeId.emailaddressid}&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+          set &quot;emailaddress&quot; = ${fromWrite(row.emailaddress)(Write.fromPutOption(Meta.StringMeta.put))},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+              &quot;rowguid&quot; = ${fromWrite(row.rowguid)(Write.fromPut(TypoUUID.put))}::uuid,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+              &quot;modifieddate&quot; = ${fromWrite(row.modifieddate)(Write.fromPut(TypoLocalDateTime.put))}::timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+          where &quot;businessentityid&quot; = ${fromWrite(compositeId.businessentityid)(Write.fromPut(BusinessentityId.put))} AND &quot;emailaddressid&quot; = ${fromWrite(compositeId.emailaddressid)(Write.fromPut(Meta.IntMeta.put))}&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       .map(_ &gt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here are the results with and without inlined implicits:</p>
<div style="width:80%;margin:auto"><select id="toggleView"><option value="min" selected="">Minimum Compile Time</option><option value="avg">Average Compile Time</option></select><div class="chart-container"><canvas id="groupedBarChart3" width="800" height="400"></canvas></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="observations">Observations<a href="#observations" class="hash-link" aria-label="Direct link to Observations" title="Direct link to Observations">​</a></h3>
<ul>
<li>This brings the compile time for doobie down to about the same as for anorm and zio-jdbc!</li>
<li>We lose a handsome amount of compile time for zio-jdbc and anorm. But it&#x27;s less clear that it&#x27;s enough to be worth inlining manually.
It&#x27;s a great conclusion actually, resolving implicits is fast as long as it&#x27;s a straightforward process.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="great-so-what-is-going-on-with-doobie-then">Great! So what is going on with doobie then?<a href="#great-so-what-is-going-on-with-doobie-then" class="hash-link" aria-label="Direct link to Great! So what is going on with doobie then?" title="Direct link to Great! So what is going on with doobie then?">​</a></h3>
<p>I honestly haven&#x27;t dug into all the details, but I have a guess which looks obvious.
In order to interpolate values into an SQL query, doobie needs to resolve a chain of implicits instead of just one.</p>
<p>In order to interpolate in the <code>emailaddress</code> field which has type <code>Option[String]</code>, this thing needs to be resolved:</p>
<div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">doobie</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">syntax</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SqlInterpolator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SingleFragment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fromWrite</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">unsaved</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">emailaddress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  doobie</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">util</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Write</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fromPutOption</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    doobie</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">util</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Put</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metaProjectionWrite</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        doobie</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">util</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">meta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Meta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">StringMeta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I&#x27;m sure this can cause the compiler to spend a lot of time looking around the companion objects of
<code>SingleFragment</code>, <code>Write</code>, <code>Put</code>, and <code>Meta</code>.</p>
<br>
<div style="background-color:#f0f0f0;color:#000;padding:20px;border-radius:8px;display:flex;align-items:center;justify-content:center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:10px"><path d="M7 20v1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1"></path><path d="M9 20h6"></path><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 16h-2v-2h2v2zm0-4h-2V8h2v6z"></path></svg><span>Key takeaway: <p>Make the compiler&#x27;s job easy! It probably shouldn&#x27;t need to go through so many layers at all.</p></span></div>
<br>
<div style="background-color:#f0f0f0;color:#000;padding:20px;border-radius:8px;display:flex;align-items:center;justify-content:center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:10px"><path d="M7 20v1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1"></path><path d="M9 20h6"></path><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 16h-2v-2h2v2zm0-4h-2V8h2v6z"></path></svg><span>Key takeaway: <p>Scala 3 must have some caching of resolved implicits that Scala 2.x doesn&#x27;t have.</p></span></div>
<br>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-work-on-benchmark">Future work on benchmark<a href="#future-work-on-benchmark" class="hash-link" aria-label="Direct link to Future work on benchmark" title="Direct link to Future work on benchmark">​</a></h2>
<p>Here are other things things I&#x27;ve done to speed up compilation of generated code, based on observations as I was developing.
A future version of the benchmark could measure the effect of these changes as well. Reach out if you&#x27;re interesting in contributing towards this.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="avoiding-anonymous-classes">Avoiding anonymous classes<a href="#avoiding-anonymous-classes" class="hash-link" aria-label="Direct link to Avoiding anonymous classes" title="Direct link to Avoiding anonymous classes">​</a></h3>
<p>Let&#x27;s have a look at the code for <code>doobie.postgres.Text[A]</code>, it&#x27;s basically this:</p>
<div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">trait</span><span class="token plain"> Text</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> outer </span><span class="token keyword" style="color:#00009f">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> unsafeEncode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> A</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sb</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> StringBuilder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">object</span><span class="token plain"> Text </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> instance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> StringBuilder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">=&gt;</span><span class="token plain"> </span><span class="token builtin">Unit</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Text</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> Text</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> unsafeEncode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> A</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sb</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> StringBuilder</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using <code>Text.instance</code> instead of <code>new Text[A]</code> saves some compilation time because it generates less bytecode.</p>
<p>If you&#x27;re a library author you should consider adding such a constructor method.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="avoiding-automatic-derivation-of-product-type-class-instances">Avoiding automatic derivation of product type class instances<a href="#avoiding-automatic-derivation-of-product-type-class-instances" class="hash-link" aria-label="Direct link to Avoiding automatic derivation of product type class instances" title="Direct link to Avoiding automatic derivation of product type class instances">​</a></h3>
<p>Typo reimplements the derivation of type class instances for product types, so the benchmark cannot measure the cost of this so far.
If you expand <code>EmailaddressRow.scala</code> above, you&#x27;ll see that <code>Read[EmailaddressRow]</code> is always implemented as <code>new Read(...)</code>.</p>
<p>It would be very interesting to measure the cost of deriving this automatically as well, we just need to patch <code>Typo</code> to use <code>Read.derived</code> instead of <code>new Read(...)</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="avoiding-type-aliases">Avoiding type aliases<a href="#avoiding-type-aliases" class="hash-link" aria-label="Direct link to Avoiding type aliases" title="Direct link to Avoiding type aliases">​</a></h3>
<p>Doobie uses a pattern where <code>doobie.util.Read</code> is exposed as <code>doobie.Read</code> through a baroque mechanism:</p>
<div class="language-scala codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-scala codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">object</span><span class="token plain"> doobie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> Aliases</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">trait</span><span class="token plain"> Aliases </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> Types </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> Modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">trait</span><span class="token plain"> Types </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/** @group Type Aliases - Core */</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> Read</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> doobie</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">util</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Read</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Typo always generates the fully qualified name <code>doobie.util.Read</code>.
It would be interesting to measure if there is a cost associated with this as well.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="final-results-and-limitations">Final results and limitations<a href="#final-results-and-limitations" class="hash-link" aria-label="Direct link to Final results and limitations" title="Direct link to Final results and limitations">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="json-libraries">JSON libraries<a href="#json-libraries" class="hash-link" aria-label="Direct link to JSON libraries" title="Direct link to JSON libraries">​</a></h3>
<p>This last graph includes compilation time for three JSON libraries as well, basically just generating type class instances for them.
I excluded them for the text above since there was nothing interesting to say about the results.
You can see how &quot;inline implicits&quot; mode also speeds up compilation of these JSON codecs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmark-limitations">Benchmark limitations<a href="#benchmark-limitations" class="hash-link" aria-label="Direct link to Benchmark limitations" title="Direct link to Benchmark limitations">​</a></h3>
<p>I think part of this improvement from &quot;inlined implicits&quot; is due to the fact that the compiler is a bit warmer since it will just have finished compiling without inlined implicits.</p>
<p>Note specifically that we get faster compiles for &quot;baseline&quot; with &quot;inlined implicits&quot; mode, although the generated code is the same.</p>
<p>I didn&#x27;t bother improving the benchmark more, because the interesting things mentioned above was very visible and consistent already.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="final-graph">Final graph<a href="#final-graph" class="hash-link" aria-label="Direct link to Final graph" title="Direct link to Final graph">​</a></h3>
<div style="width:80%;margin:auto"><select id="toggleView"><option value="min" selected="">Minimum Compile Time</option><option value="avg">Average Compile Time</option></select><div class="chart-container"><canvas id="groupedBarChart4" width="800" height="400"></canvas></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="reproducing-the-results">Reproducing the results<a href="#reproducing-the-results" class="hash-link" aria-label="Direct link to Reproducing the results" title="Direct link to Reproducing the results">​</a></h2>
<p>You can clone the <a href="https://github.com/oyvindberg/typo" target="_blank" rel="noopener noreferrer">repo</a> and run <code>bleep compile-benchmarks</code> to reproduce the results.
The benchmark code can be found in <a href="https://github.com/oyvindberg/typo/blob/main/typo-scripts/src/scala/scripts/CompileBenchmark.scala" target="_blank" rel="noopener noreferrer">CompileBenchmark.scala</a></p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/typo/blog/tags/typo/">typo</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/typo/blog/tags/scala/">scala</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/typo/blog/tags/doobie/">doobie</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/typo/blog/tags/anorm/">anorm</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/typo/blog/tags/zio-jdbc/">zio-jdbc</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/typo/blog/tags/implicits/">implicits</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/typo/blog/tags/compile-times/">compile-times</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/typo/blog/hello-zio/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Hello, ZIO</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a><ul><li><a href="#typo-output-as-a-realistic-compile-speed-test-harness" class="table-of-contents__link toc-highlight">Typo output as a realistic compile speed test harness</a></li></ul></li><li><a href="#the-generated-code" class="table-of-contents__link toc-highlight">The generated code</a></li><li><a href="#initial-comparison-of-compile-times" class="table-of-contents__link toc-highlight">Initial comparison of compile times</a></li><li><a href="#so-whats-up-with-doobie-with-scala-2x" class="table-of-contents__link toc-highlight">So what&#39;s up with doobie with Scala 2.x?</a></li><li><a href="#results-without-accidental-automatic-type-class-derivation-for-doobie" class="table-of-contents__link toc-highlight">Results without accidental automatic type class derivation for doobie</a></li><li><a href="#query-interpolation-woes" class="table-of-contents__link toc-highlight">Query interpolation woes.</a><ul><li><a href="#observations" class="table-of-contents__link toc-highlight">Observations</a></li><li><a href="#great-so-what-is-going-on-with-doobie-then" class="table-of-contents__link toc-highlight">Great! So what is going on with doobie then?</a></li></ul></li><li><a href="#future-work-on-benchmark" class="table-of-contents__link toc-highlight">Future work on benchmark</a><ul><li><a href="#avoiding-anonymous-classes" class="table-of-contents__link toc-highlight">Avoiding anonymous classes</a></li><li><a href="#avoiding-automatic-derivation-of-product-type-class-instances" class="table-of-contents__link toc-highlight">Avoiding automatic derivation of product type class instances</a></li><li><a href="#avoiding-type-aliases" class="table-of-contents__link toc-highlight">Avoiding type aliases</a></li></ul></li><li><a href="#final-results-and-limitations" class="table-of-contents__link toc-highlight">Final results and limitations</a><ul><li><a href="#json-libraries" class="table-of-contents__link toc-highlight">JSON libraries</a></li><li><a href="#benchmark-limitations" class="table-of-contents__link toc-highlight">Benchmark limitations</a></li><li><a href="#final-graph" class="table-of-contents__link toc-highlight">Final graph</a></li></ul></li><li><a href="#reproducing-the-results" class="table-of-contents__link toc-highlight">Reproducing the results</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/oyvindberg/typo" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Øyvind Raddum Berg</div></div></div></footer></div>
</body>
</html>